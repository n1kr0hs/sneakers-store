import{w as g,o as h,a as i,c as m,b as x,f as y,j as I,u as k,i as $,g as l,h as A,_ as B}from"./index-COFSc0Ph.js";import{_ as w}from"./CardList-DeZ3Qena.js";const C={key:0,class:"flex flex-col items-center justify-center py-20"},c="https://14ef51dbd6f2e9ea.mokky.dev",U={__name:"Favorites",setup(F){const a=A([]),n=$("cartContext"),{cartItems:d,toggleCartItem:f}=n??{},u=async()=>{try{const[{data:e},{data:t}]=await Promise.all([l.get(`${c}/favorites`),l.get(`${c}/items`)]),r=new Map(t.map(o=>[o.id,o]));a.value=e.map(o=>{const s=r.get(o.productId);return s?{...s,imageUrl:s.imageUrl?.startsWith("/")?s.imageUrl:`/${s.imageUrl}`,isFavorite:!0,favoriteId:o.id,isAdded:d?.value?.some(_=>_.id===s.id)??!1}:null}).filter(Boolean)}catch(e){console.error("Ошибка загрузки избранного:",e)}},v=e=>{n&&f(e)},p=async e=>{try{await l.delete(`${c}/favorites/${e.favoriteId}`),a.value=a.value.filter(t=>t.id!==e.id)}catch(t){console.error("Ошибка удаления из избранного:",t)}};return g(()=>d?.value??[],e=>{a.value=a.value.map(t=>({...t,isAdded:e.some(r=>r.id===t.id)}))},{deep:!0}),h(u),(e,t)=>(i(),m("div",null,[t[0]||(t[0]=x("h2",{class:"text-3xl font-bold mb-8"},"Мои закладки",-1)),a.value.length?(i(),I(k(w),{key:1,items:a.value,onAddToFavorite:p,onAddToCart:v},null,8,["items"])):(i(),m("div",C,[y(B,{title:"Закладок пока нет",descr:"Добавляйте товары в избранное — они появятся здесь","image-url":"/heart.svg"})]))]))}};export{U as default};
