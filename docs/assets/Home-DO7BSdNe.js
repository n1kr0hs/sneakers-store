import{o as n,c as p,a as o,w as k,t as _,b as y,F as x,r as C,d as I,e as $,f as b,g as A,v as B,h as T,i as S,u as M,j,k as v,l as Q,m as U}from"./index-CCsOVYem.js";const L={class:"relative bg-white border border-slate-100 rounded-3xl p-8 cursor-pointer transition hover:-translate-y-2 hover:shadow-xl"},N=["src"],V=["src"],D={class:"mt-2"},E={class:"flex justify-between mt-5"},H={class:"flex flex-col"},P={class:"font-bold"},q=["src"],z={__name:"CardListItem",props:{id:Number,imageUrl:String,title:String,price:Number,isFavorite:Boolean,isAdded:Boolean,onClickFavorite:{type:Function,default:null},onClickAdd:{type:Function,default:null}},setup(l){return(r,s)=>(n(),p("div",L,[o("img",{src:l.isFavorite?"like-2.svg":"like-1.svg",onClick:s[0]||(s[0]=k(d=>l.onClickFavorite?.(),["stop"])),alt:"Like",class:"absolute top-8 left-8"},null,8,N),o("img",{src:l.imageUrl,class:"",alt:"Sneaker"},null,8,V),o("p",D,_(l.title),1),o("div",E,[o("div",H,[s[2]||(s[2]=o("span",{class:"text-slate-400"},"Цена:",-1)),o("span",P,_(l.price)+" руб.",1)]),o("img",{src:l.isAdded?"checked.svg":"plus.svg",onClick:s[1]||(s[1]=k(d=>l.onClickAdd?.(),["stop"])),alt:"Добавить в корзину"},null,8,q)])]))}},G={class:"grid grid-cols-4 gap-5"},J={__name:"CardList",props:{items:Array},emits:["addToFavorite","addToCart"],setup(l,{emit:r}){const s=r;return(d,c)=>{const m=I("auto-animate");return y((n(),p("div",G,[(n(!0),p(x,null,C(l.items,i=>(n(),$(z,{key:i.id,id:i.id,title:i.title,"image-url":i.imageUrl,price:i.price,"is-favorite":i.isFavorite,"is-added":i.isAdded,"on-click-favorite":()=>s("addToFavorite",i),"on-click-add":()=>s("addToCart",i)},null,8,["id","title","image-url","price","is-favorite","is-added","on-click-favorite","on-click-add"]))),128))])),[[m]])}}},K="/vue-project/search.svg",O={class:"flex justify-between items-center"},R={class:"flex gap-4"},W={class:"relative"},f="https://14ef51dbd6f2e9ea.mokky.dev",Y={__name:"Home",setup(l){const r=U([]),s=Q({sortBy:"title",searchQuery:""}),d=j("cartContext");if(!d)throw new Error("cartContext is not provided");const{cartItems:c,toggleCartItem:m}=d,i=(t,e)=>{r.value=r.value.map(a=>a.id===t?{...a,...e}:a)},g=async()=>{try{const{data:t}=await v.get(`${f}/favorites`),e=new Map(t.map(a=>[a.productId,a]));r.value=r.value.map(a=>{const u=e.get(a.id);return u?{...a,isFavorite:!0,favoriteId:u.id}:{...a,isFavorite:!1,favoriteId:null}})}catch(t){console.error("Ошибка загрузки избранного:",t)}},h=async()=>{try{const t={sortBy:s.sortBy};s.searchQuery&&(t.title=`*${s.searchQuery}*`);const{data:e}=await v.get(`${f}/items`,{params:t});r.value=e.map(a=>({...a,isFavorite:!1,favoriteId:null,isAdded:c.value.some(u=>u.id===a.id)}))}catch(t){console.error("Ошибка загрузки товаров:",t)}},F=t=>{m(t);const e=c.value.some(a=>a.id===t.id);i(t.id,{isAdded:e})},w=async t=>{try{if(t.isFavorite)t.favoriteId&&(await v.delete(`${f}/favorites/${t.favoriteId}`),i(t.id,{isFavorite:!1,favoriteId:null}));else{const{data:e}=await v.post(`${f}/favorites`,{productId:t.id});i(t.id,{isFavorite:!0,favoriteId:e.id})}}catch(e){console.error("Ошибка обновления избранного:",e)}};return b(s,async()=>{await h(),await g()},{deep:!0}),b(c,t=>{r.value=r.value.map(e=>({...e,isAdded:t.some(a=>a.id===e.id)}))},{deep:!0}),A(async()=>{await h(),await g()}),(t,e)=>(n(),p(x,null,[o("div",O,[e[4]||(e[4]=o("h2",{class:"text-3xl font-bold mb-8"},"Все кроссовки",-1)),o("div",R,[y(o("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.sortBy=a),class:"py-2 px-3 border border-gray-200 rounded-md outline-none","aria-label":"Сортировка"},[...e[2]||(e[2]=[o("option",{value:"title"},"По названию",-1),o("option",{value:"price"},"По цене (дешевые)",-1),o("option",{value:"-price"},"По цене (Дорогие)",-1)])],512),[[B,s.sortBy]]),o("div",W,[e[3]||(e[3]=o("img",{class:"absolute left-4 top-3",src:K,alt:"Search"},null,-1)),y(o("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.searchQuery=a),class:"border border-gray-200 rounded-md py-2 pl-11 pr-4 outline-none focus:border-gray-400",placeholder:"Поиск...",type:"text","aria-label":"Поиск"},null,512),[[T,s.searchQuery]])])])]),S(M(J),{items:r.value,onAddToFavorite:w,onAddToCart:F},null,8,["items"])],64))}};export{Y as default};
