import{w as p,o as b,a as g,c as h,b as s,d as m,v as x,e as F,f as _,u as B,F as A,i as C,g as d,r as $,h as M}from"./index-COFSc0Ph.js";import{_ as Q}from"./CardList-DeZ3Qena.js";const T="/vue-project/search.svg",k={class:"flex justify-between items-center"},S={class:"flex gap-4"},V={class:"relative"},n="https://14ef51dbd6f2e9ea.mokky.dev",U={__name:"Home",setup(j){const o=M([]),r=$({sortBy:"title",searchQuery:""}),v=C("cartContext");if(!v)throw new Error("cartContext is not provided");const{cartItems:l,toggleCartItem:y}=v,c=(t,e)=>{o.value=o.value.map(a=>a.id===t?{...a,...e}:a)},u=async()=>{try{const{data:t}=await d.get(`${n}/favorites`),e=new Map(t.map(a=>[a.productId,a]));o.value=o.value.map(a=>{const i=e.get(a.id);return i?{...a,isFavorite:!0,favoriteId:i.id}:{...a,isFavorite:!1,favoriteId:null}})}catch(t){console.error("Ошибка загрузки избранного:",t)}},f=async()=>{try{const t={sortBy:r.sortBy};r.searchQuery&&(t.title=`*${r.searchQuery}*`);const{data:e}=await d.get(`${n}/items`,{params:t});o.value=e.map(a=>({...a,isFavorite:!1,favoriteId:null,isAdded:l.value.some(i=>i.id===a.id)}))}catch(t){console.error("Ошибка загрузки товаров:",t)}},w=t=>{y(t);const e=l.value.some(a=>a.id===t.id);c(t.id,{isAdded:e})},I=async t=>{try{if(t.isFavorite)t.favoriteId&&(await d.delete(`${n}/favorites/${t.favoriteId}`),c(t.id,{isFavorite:!1,favoriteId:null}));else{const{data:e}=await d.post(`${n}/favorites`,{productId:t.id});c(t.id,{isFavorite:!0,favoriteId:e.id})}}catch(e){console.error("Ошибка обновления избранного:",e)}};return p(r,async()=>{await f(),await u()},{deep:!0}),p(l,t=>{o.value=o.value.map(e=>({...e,isAdded:t.some(a=>a.id===e.id)}))},{deep:!0}),b(async()=>{await f(),await u()}),(t,e)=>(g(),h(A,null,[s("div",k,[e[4]||(e[4]=s("h2",{class:"text-3xl font-bold mb-8"},"Все кроссовки",-1)),s("div",S,[m(s("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>r.sortBy=a),class:"py-2 px-3 border border-gray-200 rounded-md outline-none","aria-label":"Сортировка"},[...e[2]||(e[2]=[s("option",{value:"title"},"По названию",-1),s("option",{value:"price"},"По цене (дешевые)",-1),s("option",{value:"-price"},"По цене (Дорогие)",-1)])],512),[[x,r.sortBy]]),s("div",V,[e[3]||(e[3]=s("img",{class:"absolute left-4 top-3",src:T,alt:"Search"},null,-1)),m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>r.searchQuery=a),class:"border border-gray-200 rounded-md py-2 pl-11 pr-4 outline-none focus:border-gray-400",placeholder:"Поиск...",type:"text","aria-label":"Поиск"},null,512),[[F,r.searchQuery]])])])]),_(B(Q),{items:o.value,onAddToFavorite:I,onAddToCart:w},null,8,["items"])],64))}};export{U as default};
