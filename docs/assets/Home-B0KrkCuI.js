import{i as ee,w as B,o as te,a as re,c as ae,b as d,d as P,v as ne,e as oe,f as ie,u as se,r as q,g as le,h as de,j as ce,k as ue,l as fe}from"./index-BK7zLJx7.js";import{_ as me}from"./CardList-BjWGvDSP.js";const ve="/sneakers-store/search.svg";var S=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pe(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var $,G;function ye(){if(G)return $;G=1;var u="Expected a function",i=NaN,l="[object Symbol]",v=/^\s+|\s+$/g,g=/^[-+]0x[0-9a-f]+$/i,k=/^0b[01]+$/i,h=/^0o[0-7]+$/i,x=parseInt,I=typeof S=="object"&&S&&S.Object===Object&&S,E=typeof self=="object"&&self&&self.Object===Object&&self,M=I||E||Function("return this")(),C=Object.prototype,t=C.toString,r=Math.max,a=Math.min,f=function(){return M.Date.now()};function H(e,o,c){var y,w,F,b,s,p,T=0,D=!1,j=!1,L=!0;if(typeof e!="function")throw new TypeError(u);o=U(o)||0,A(c)&&(D=!!c.leading,j="maxWait"in c,F=j?r(U(c.maxWait)||0,o):F,L="trailing"in c?!!c.trailing:L);function N(n){var m=y,_=w;return y=w=void 0,T=n,b=e.apply(_,m),b}function J(n){return T=n,s=setTimeout(O,o),D?N(n):b}function K(n){var m=n-p,_=n-T,W=o-m;return j?a(W,F-_):W}function R(n){var m=n-p,_=n-T;return p===void 0||m>=o||m<0||j&&_>=F}function O(){var n=f();if(R(n))return V(n);s=setTimeout(O,K(n))}function V(n){return s=void 0,L&&y?N(n):(y=w=void 0,b)}function Y(){s!==void 0&&clearTimeout(s),T=0,y=p=w=s=void 0}function Z(){return s===void 0?b:V(f())}function Q(){var n=f(),m=R(n);if(y=arguments,w=this,p=n,m){if(s===void 0)return J(p);if(j)return s=setTimeout(O,o),N(p)}return s===void 0&&(s=setTimeout(O,o)),b}return Q.cancel=Y,Q.flush=Z,Q}function A(e){var o=typeof e;return!!e&&(o=="object"||o=="function")}function X(e){return!!e&&typeof e=="object"}function z(e){return typeof e=="symbol"||X(e)&&t.call(e)==l}function U(e){if(typeof e=="number")return e;if(z(e))return i;if(A(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=A(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=e.replace(v,"");var c=k.test(e);return c||h.test(e)?x(e.slice(2),c?2:8):g.test(e)?i:+e}return $=H,$}var be=ye();const ge=pe(be),he={class:"space-y-6"},xe={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},Ie={class:"flex flex-col sm:flex-row gap-3 sm:gap-4"},we={class:"relative"},_e={__name:"Home",setup(u){const i=q([]),l=le({sortBy:"title",searchQuery:""}),v=q(""),{cartItems:g,toggleCartItem:k}=ee("cartContext"),h=(t,r)=>{i.value=i.value.map(a=>a.id===t?{...a,...r}:a)},x=async()=>{try{const t={sortBy:l.sortBy};v.value&&(t.title=`*${v.value}*`);const r=await de(t);i.value=r.map(a=>({...a,imageUrl:a.imageUrl||"",isFavorite:!1,favoriteId:null,isAdded:g.value.some(f=>f.id===a.id)}))}catch(t){console.error("Ошибка загрузки товаров:",t)}},I=async()=>{try{const t=await ce(),r=new Map(t.map(a=>[a.productId,a]));i.value=i.value.map(a=>{const f=r.get(a.id);return f?{...a,isFavorite:!0,favoriteId:f.id}:{...a,isFavorite:!1,favoriteId:null}})}catch(t){console.error("Ошибка загрузки избранного:",t)}},E=t=>{k(t),h(t.id,{isAdded:g.value.some(r=>r.id===t.id)})},M=async t=>{try{if(t.isFavorite)t.favoriteId&&(await fe(t.favoriteId),h(t.id,{isFavorite:!1,favoriteId:null}));else{const r=await ue(t.id);h(t.id,{isFavorite:!0,favoriteId:r.id})}}catch(r){console.error("Ошибка обновления избранного:",r)}},C=ge(t=>{v.value=t},300);return B(()=>l.searchQuery,t=>{C(t)}),B(v,async()=>{await x(),await I()}),B(()=>l.sortBy,async()=>{await x(),await I()}),B(g,t=>{i.value=i.value.map(r=>({...r,isAdded:t.some(a=>a.id===r.id)}))},{deep:!0}),te(async()=>{v.value=l.searchQuery,await x(),await I()}),(t,r)=>(re(),ae("div",he,[d("div",xe,[r[4]||(r[4]=d("h2",{class:"text-2xl sm:text-3xl font-bold animate-fade-in"}," Все кроссовки ",-1)),d("div",Ie,[P(d("select",{"onUpdate:modelValue":r[0]||(r[0]=a=>l.sortBy=a),class:"py-2 px-3 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-lime-400 transition-all","aria-label":"Сортировка"},[...r[2]||(r[2]=[d("option",{value:"title"},"По названию",-1),d("option",{value:"price"},"По цене (дешевые)",-1),d("option",{value:"-price"},"По цене (дорогие)",-1)])],512),[[ne,l.sortBy]]),d("div",we,[r[3]||(r[3]=d("img",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 opacity-50",src:ve,alt:""},null,-1)),P(d("input",{"onUpdate:modelValue":r[1]||(r[1]=a=>l.searchQuery=a),class:"w-full sm:w-48 border border-gray-200 rounded-lg py-2 pl-10 pr-4 outline-none focus:ring-2 focus:ring-lime-400 transition-all",placeholder:"Поиск...",type:"text","aria-label":"Поиск"},null,512),[[oe,l.searchQuery]])])])]),ie(se(me),{items:i.value,onAddToFavorite:M,onAddToCart:E},null,8,["items"])]))}};export{_e as default};
