import{u as ee,w as B,o as te,a as re,c as ae,b as c,d as P,v as oe,e as ne,f as ie,g as se,r as q,h as le,i as de}from"./index-CI2Dvnfl.js";import{u as ce,_ as ue}from"./favorites-DkWmT1zy.js";const fe="/sneakers-store/search.svg";var k=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function me(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var $,G;function ve(){if(G)return $;G=1;var f="Expected a function",i=NaN,l="[object Symbol]",v=/^\s+|\s+$/g,y=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,h=/^0o[0-7]+$/i,x=parseInt,j=typeof k=="object"&&k&&k.Object===Object&&k,E=typeof self=="object"&&self&&self.Object===Object&&self,C=j||E||Function("return this")(),A=Object.prototype,e=A.toString,r=Math.max,o=Math.min,w=function(){return C.Date.now()};function H(t,n,u){var b,F,S,g,s,p,I=0,D=!1,T=!1,L=!0;if(typeof t!="function")throw new TypeError(f);n=U(n)||0,M(u)&&(D=!!u.leading,T="maxWait"in u,S=T?r(U(u.maxWait)||0,n):S,L="trailing"in u?!!u.trailing:L);function N(a){var m=b,_=F;return b=F=void 0,I=a,g=t.apply(_,m),g}function J(a){return I=a,s=setTimeout(O,n),D?N(a):g}function K(a){var m=a-p,_=a-I,W=n-m;return T?o(W,S-_):W}function R(a){var m=a-p,_=a-I;return p===void 0||m>=n||m<0||T&&_>=S}function O(){var a=w();if(R(a))return V(a);s=setTimeout(O,K(a))}function V(a){return s=void 0,L&&b?N(a):(b=F=void 0,g)}function Y(){s!==void 0&&clearTimeout(s),I=0,b=p=F=s=void 0}function Z(){return s===void 0?g:V(w())}function Q(){var a=w(),m=R(a);if(b=arguments,F=this,p=a,m){if(s===void 0)return J(p);if(T)return s=setTimeout(O,n),N(p)}return s===void 0&&(s=setTimeout(O,n)),g}return Q.cancel=Y,Q.flush=Z,Q}function M(t){var n=typeof t;return!!t&&(n=="object"||n=="function")}function X(t){return!!t&&typeof t=="object"}function z(t){return typeof t=="symbol"||X(t)&&e.call(t)==l}function U(t){if(typeof t=="number")return t;if(z(t))return i;if(M(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=M(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=t.replace(v,"");var u=d.test(t);return u||h.test(t)?x(t.slice(2),u?2:8):y.test(t)?i:+t}return $=H,$}var ye=ve();const pe=me(ye),be={class:"space-y-6"},ge={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},he={class:"flex flex-col sm:flex-row gap-3 sm:gap-4"},xe={class:"relative"},Ie={__name:"Home",setup(f){const i=q([]),l=le({sortBy:"title",searchQuery:""}),v=q(""),y=ee(),d=ce(),h=(e,r)=>{i.value=i.value.map(o=>o.id===e?{...o,...r}:o)},x=async()=>{try{const e={sortBy:l.sortBy};v.value&&(e.title=`*${v.value}*`);const r=await de(e);i.value=r.map(o=>({...o,imageUrl:o.imageUrl||"",isFavorite:d.isFavorite(o.id),favoriteId:d.getFavoriteId(o.id)||null,isAdded:y.items.some(w=>w.id===o.id)}))}catch(e){console.error("Ошибка загрузки товаров:",e)}},j=async()=>{try{await d.fetchFavorites(),i.value=i.value.map(e=>({...e,isFavorite:d.isFavorite(e.id),favoriteId:d.getFavoriteId(e.id)||null}))}catch(e){console.error("Ошибка загрузки избранного:",e)}},E=e=>{y.toggleCartItem(e),h(e.id,{isAdded:y.items.some(r=>r.id===e.id)})},C=async e=>{try{if(e.isFavorite)await d.removeFavorite(e.id),h(e.id,{isFavorite:!1,favoriteId:null});else{const r=await d.addFavorite(e.id);h(e.id,{isFavorite:!0,favoriteId:r.id})}}catch(r){console.error("Ошибка обновления избранного:",r)}},A=pe(e=>{v.value=e},300);return B(()=>l.searchQuery,e=>{A(e)}),B(v,async()=>{await x(),await j()}),B(()=>l.sortBy,async()=>{await x(),await j()}),B(()=>y.items,()=>{i.value=i.value.map(e=>({...e,isAdded:y.items.some(r=>r.id===e.id)}))},{deep:!0}),te(async()=>{v.value=l.searchQuery,await d.fetchFavorites(),await x()}),(e,r)=>(re(),ae("div",be,[c("div",ge,[r[4]||(r[4]=c("h2",{class:"text-2xl sm:text-3xl font-bold animate-fade-in"}," Все кроссовки ",-1)),c("div",he,[P(c("select",{"onUpdate:modelValue":r[0]||(r[0]=o=>l.sortBy=o),class:"py-2 px-3 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-lime-400 transition-all","aria-label":"Сортировка"},[...r[2]||(r[2]=[c("option",{value:"title"},"По названию",-1),c("option",{value:"price"},"По цене (дешевые)",-1),c("option",{value:"-price"},"По цене (дорогие)",-1)])],512),[[oe,l.sortBy]]),c("div",xe,[r[3]||(r[3]=c("img",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 opacity-50",src:fe,alt:""},null,-1)),P(c("input",{"onUpdate:modelValue":r[1]||(r[1]=o=>l.searchQuery=o),class:"w-full sm:w-48 border border-gray-200 rounded-lg py-2 pl-10 pr-4 outline-none focus:ring-2 focus:ring-lime-400 transition-all",placeholder:"Поиск...",type:"text","aria-label":"Поиск"},null,512),[[ne,l.searchQuery]])])])]),ie(se(ue),{items:i.value,onAddToFavorite:C,onAddToCart:E},null,8,["items"])]))}};export{Ie as default};
