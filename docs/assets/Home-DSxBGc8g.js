import{i as y,w as u,o as g,a as w,c as x,b as s,d as v,v as h,e as I,f as F,u as _,g as b,h as B,r as U,j as A,k as M,l as Q}from"./index-DWsXD6TO.js";import{_ as T}from"./CardList-rB9ISxEF.js";const k="/sneakers-store-vue/search.svg",C={class:"space-y-6"},V={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},j={class:"flex flex-col sm:flex-row gap-3 sm:gap-4"},$={class:"relative"},H={__name:"Home",setup(N){const o=A([]),r=U({sortBy:"title",searchQuery:""}),{cartItems:l,toggleCartItem:f}=y("cartContext"),n=(a,e)=>{o.value=o.value.map(t=>t.id===a?{...t,...e}:t)},d=async()=>{try{const a={sortBy:r.sortBy};r.searchQuery&&(a.title=`*${r.searchQuery}*`);const e=await b(a);o.value=e.map(t=>({...t,imageUrl:t.imageUrl?.startsWith("/")?t.imageUrl:`/${t.imageUrl}`,isFavorite:!1,favoriteId:null,isAdded:l.value.some(i=>i.id===t.id)}))}catch(a){console.error("Ошибка загрузки товаров:",a)}},c=async()=>{try{const a=await B(),e=new Map(a.map(t=>[t.productId,t]));o.value=o.value.map(t=>{const i=e.get(t.id);return i?{...t,isFavorite:!0,favoriteId:i.id}:{...t,isFavorite:!1,favoriteId:null}})}catch(a){console.error("Ошибка загрузки избранного:",a)}},m=a=>{f(a),n(a.id,{isAdded:l.value.some(e=>e.id===a.id)})},p=async a=>{try{if(a.isFavorite)a.favoriteId&&(await Q(a.favoriteId),n(a.id,{isFavorite:!1,favoriteId:null}));else{const e=await M(a.id);n(a.id,{isFavorite:!0,favoriteId:e.id})}}catch(e){console.error("Ошибка обновления избранного:",e)}};return u(r,async()=>{await d(),await c()},{deep:!0}),u(l,a=>{o.value=o.value.map(e=>({...e,isAdded:a.some(t=>t.id===e.id)}))},{deep:!0}),g(async()=>{await d(),await c()}),(a,e)=>(w(),x("div",C,[s("div",V,[e[4]||(e[4]=s("h2",{class:"text-2xl sm:text-3xl font-bold animate-fade-in"}," Все кроссовки ",-1)),s("div",j,[v(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.sortBy=t),class:"py-2 px-3 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-lime-400 transition-all","aria-label":"Сортировка"},[...e[2]||(e[2]=[s("option",{value:"title"},"По названию",-1),s("option",{value:"price"},"По цене (дешевые)",-1),s("option",{value:"-price"},"По цене (дорогие)",-1)])],512),[[h,r.sortBy]]),s("div",$,[e[3]||(e[3]=s("img",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 opacity-50",src:k,alt:""},null,-1)),v(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.searchQuery=t),class:"w-full sm:w-48 border border-gray-200 rounded-lg py-2 pl-10 pr-4 outline-none focus:ring-2 focus:ring-lime-400 transition-all",placeholder:"Поиск...",type:"text","aria-label":"Поиск"},null,512),[[I,r.searchQuery]])])])]),F(_(T),{items:o.value,onAddToFavorite:p,onAddToCart:m},null,8,["items"])]))}};export{H as default};
